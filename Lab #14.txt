// Joining tables

database_labs=# CREATE TABLE customers (
database_labs(#     customer_id SERIAL PRIMARY KEY,
database_labs(#     name  VARCHAR(100),
database_labs(#     email VARCHAR(100)
database_labs(# );
CREATE TABLE
database_labs=# CREATE TABLE orders (
database_labs(#     order_id SERIAL PRIMARY KEY,
database_labs(#     customer_id INTEGER REFERENCES customers(customer_id),
database_labs(#     order_date DATE,
database_labs(#     total_amount DECIMAL(10,2)
database_labs(# );
CREATE TABLE
database_labs=# CREATE TABLE products (
database_labs(#     product_id SERIAL PRIMARY KEY,
database_labs(#     product_name VARCHAR(100),
database_labs(#     price DECIMAL(10,2)
database_labs(# );
CREATE TABLE
database_labs=#
database_labs=#
database_labs=# CREATE TABLE order_items (
database_labs(#     order_item_id SERIAL PRIMARY KEY,
database_labs(#     order_id INTEGER REFERENCES orders(order_id),
database_labs(#     product_id INTEGER REFERENCES products(product_id),
database_labs(#     quantity INT
database_labs(# );
CREATE TABLE
database_labs=#
database_labs=#
database_labs=# CREATE TABLE employees (
database_labs(#     employee_id SERIAL PRIMARY KEY,
database_labs(#     name VARCHAR(100),
database_labs(#     manager_id INTEGER REFERENCES employees(employee_id)
database_labs(# );
CREATE TABLE
database_labs=# CREATE TABLE users (
database_labs(#     user_id SERIAL PRIMARY KEY,
database_labs(#     username VARCHAR(100)
database_labs(# );
CREATE TABLE
database_labs=# CREATE TABLE user_profiles (
database_labs(#     profile_id SERIAL PRIMARY KEY,
database_labs(#     user_id INTEGER UNIQUE REFERENCES users(user_id),
database_labs(#     first_name VARCHAR(100),
database_labs(#     last_name  VARCHAR(100),
database_labs(#     phone      VARCHAR(20)
database_labs(# );
CREATE TABLE
database_labs=# CREATE TABLE authors (
database_labs(#     author_id SERIAL PRIMARY KEY,
database_labs(#     author_name VARCHAR(100)
database_labs(# );
CREATE TABLE
database_labs=# CREATE TABLE books (
database_labs(#     book_id SERIAL PRIMARY KEY,
database_labs(#     author_id INTEGER REFERENCES authors(author_id),
database_labs(#     title VARCHAR(200),
database_labs(#     publication_year INT
database_labs(# );
CREATE TABLE
database_labs=# CREATE TABLE students (
database_labs(#     student_id SERIAL PRIMARY KEY,
database_labs(#     student_name VARCHAR(100)
database_labs(# );
CREATE TABLE
database_labs=# CREATE TABLE courses (
database_labs(#     course_id SERIAL PRIMARY KEY,
database_labs(#     course_name VARCHAR(100)
database_labs(# );
CREATE TABLE
database_labs=# CREATE TABLE enrollments (
database_labs(#     enrollment_id SERIAL PRIMARY KEY,
database_labs(#     student_id INTEGER REFERENCES students(student_id),
database_labs(#     course_id  INTEGER REFERENCES courses(course_id),
database_labs(#     enrollment_date DATE,
database_labs(#     grade VARCHAR(5)
database_labs(# );
CREATE TABLE
database_labs=# INSERT INTO customers (name, email) VALUES
database_labs-# ('Alice', 'alice@example.com'),
database_labs-# ('Bob', 'bob@example.com'),
database_labs-# ('Carol', 'carol@example.com');
INSERT 0 3
database_labs=# INSERT INTO orders (customer_id, order_date, total_amount) VALUES
database_labs-# (1, '2024-01-10', 150.50),
database_labs-# (2, '2024-02-05', 220.00);
INSERT 0 2
database_labs=# INSERT INTO products (product_name, price) VALUES
database_labs-# ('Laptop', 1200.00),
database_labs-# ('Phone', 700.00),
database_labs-# ('Tablet', 500.00);
INSERT 0 3
database_labs=#
database_labs=# INSERT INTO order_items (order_id, product_id, quantity) VALUES
database_labs-# (1, 1, 1),
database_labs-# (1, 2, 1),
database_labs-# (2, 3, 2);
INSERT 0 3
database_labs=# INSERT INTO employees (name, manager_id) VALUES
database_labs-# ('John', NULL),
database_labs-# ('Sara', 1),
database_labs-# ('Michael', 1),
database_labs-# ('Anna', 2);
INSERT 0 4
database_labs=#
database_labs=# INSERT INTO users (username) VALUES
database_labs-# ('userA'), ('userB');
INSERT 0 2
database_labs=# INSERT INTO user_profiles (user_id, first_name, last_name, phone) VALUES
database_labs-# (1, 'Adam', 'Khan', '555-111'),
database_labs-# (2, 'Bella', 'Ray', '555-222');
INSERT 0 2
database_labs=# INSERT INTO authors (author_name) VALUES
database_labs-# ('George Orwell'), ('Jane Austen');
INSERT 0 2
database_labs=# INSERT INTO books (author_id, title, publication_year) VALUES
database_labs-# (1, '1984', 1949),
database_labs-# (1, 'Animal Farm', 1945),
database_labs-# (2, 'Pride and Prejudice', 1813);
INSERT 0 3
database_labs=# INSERT INTO students (student_name) VALUES
database_labs-# ('Aibek'), ('Ainura'), ('Bakyt');
INSERT 0 3
database_labs=# INSERT INTO courses (course_name) VALUES
database_labs-# ('Mathematics'), ('Physics'), ('CS Fundamentals');
INSERT 0 3
database_labs=# INSERT INTO enrollments (student_id, course_id, enrollment_date, grade) VALUES
database_labs-# (1, 1, '2024-01-20', 'A'),
database_labs-# (1, 2, '2024-02-10', 'B'),
database_labs-# (2, 3, '2024-02-12', 'A'),
database_labs-# (3, 2, '2024-03-01', NULL);
INSERT 0 4
database_labs=# SELECT c.name, c.email, o.order_date, o.total_amount
database_labs-# FROM customers c
database_labs-# INNER JOIN orders o ON c.customer_id = o.customer_id;
 name  |       email       | order_date | total_amount
-------+-------------------+------------+--------------
 Alice | alice@example.com | 2024-01-10 |       150.50
 Bob   | bob@example.com   | 2024-02-05 |       220.00
(2 rows)


database_labs=# SELECT c.name, c.email, o.order_date, o.total_amount
database_labs-# FROM customers c
database_labs-# LEFT JOIN orders o ON c.customer_id = o.customer_id;
 name  |       email       | order_date | total_amount
-------+-------------------+------------+--------------
 Alice | alice@example.com | 2024-01-10 |       150.50
 Bob   | bob@example.com   | 2024-02-05 |       220.00
 Carol | carol@example.com |            |
(3 rows)


database_labs=# SELECT c.name, c.email, o.order_date, o.total_amount
database_labs-# FROM customers c
database_labs-# RIGHT JOIN orders o ON c.customer_id = o.customer_id;
 name  |       email       | order_date | total_amount
-------+-------------------+------------+--------------
 Alice | alice@example.com | 2024-01-10 |       150.50
 Bob   | bob@example.com   | 2024-02-05 |       220.00
(2 rows)


database_labs=# SELECT c.name, c.email, o.order_date, o.total_amount
database_labs-# FROM customers c
database_labs-# FULL OUTER JOIN orders o ON c.customer_id = o.customer_id;
 name  |       email       | order_date | total_amount
-------+-------------------+------------+--------------
 Alice | alice@example.com | 2024-01-10 |       150.50
 Bob   | bob@example.com   | 2024-02-05 |       220.00
 Carol | carol@example.com |            |
(3 rows)


database_labs=# SELECT c.name, p.product_name
database_labs-# FROM customers c
database_labs-# CROSS JOIN products p;
 name  | product_name
-------+--------------
 Alice | Laptop
 Bob   | Laptop
 Carol | Laptop
 Alice | Phone
 Bob   | Phone
 Carol | Phone
 Alice | Tablet
 Bob   | Tablet
 Carol | Tablet
(9 rows)


database_labs=#
database_labs=# SELECT c.name, o.order_date, oi.quantity, p.product_name, p.price
database_labs-# FROM customers c
database_labs-# INNER JOIN orders o ON c.customer_id = o.customer_id
database_labs-# INNER JOIN order_items oi ON o.order_id = oi.order_id
database_labs-# INNER JOIN products p ON oi.product_id = p.product_id;
 name  | order_date | quantity | product_name |  price
-------+------------+----------+--------------+---------
 Alice | 2024-01-10 |        1 | Laptop       | 1200.00
 Alice | 2024-01-10 |        1 | Phone        |  700.00
 Bob   | 2024-02-05 |        2 | Tablet       |  500.00
(3 rows)


database_labs=# SELECT e1.name AS employee, e2.name AS manager
database_labs-# FROM employees e1
database_labs-# LEFT JOIN employees e2 ON e1.manager_id = e2.employee_id;
 employee | manager
----------+---------
 John     |
 Sara     | John
 Michael  | John
 Anna     | Sara
(4 rows)


database_labs=# SELECT c.name, o.order_date, o.total_amount
database_labs-# FROM customers c
database_labs-# INNER JOIN orders o ON c.customer_id = o.customer_id
database_labs-# WHERE o.order_date >= '2024-01-01'
database_labs-#   AND o.total_amount > 100;
 name  | order_date | total_amount
-------+------------+--------------
 Alice | 2024-01-10 |       150.50
 Bob   | 2024-02-05 |       220.00
(2 rows)


database_labs=#
database_labs=# SELECT u.username, up.first_name, up.last_name, up.phone
database_labs-# FROM users u
database_labs-# LEFT JOIN user_profiles up ON u.user_id = up.user_id;
 username | first_name | last_name |  phone
----------+------------+-----------+---------
 userA    | Adam       | Khan      | 555-111
 userB    | Bella      | Ray       | 555-222
(2 rows)


database_labs=# SELECT a.author_name, b.title, b.publication_year
database_labs-# FROM authors a
database_labs-# INNER JOIN books b ON a.author_id = b.author_id
database_labs-# ORDER BY a.author_name, b.publication_year;
  author_name  |        title        | publication_year
---------------+---------------------+------------------
 George Orwell | Animal Farm         |             1945
 George Orwell | 1984                |             1949
 Jane Austen   | Pride and Prejudice |             1813
(3 rows)


database_labs=# SELECT s.student_name, c.course_name, e.enrollment_date, e.grade
database_labs-# FROM students s
database_labs-# INNER JOIN enrollments e ON s.student_id = e.student_id
database_labs-# INNER JOIN courses c ON e.course_id = c.course_id
database_labs-# WHERE e.grade IS NOT NULL
database_labs-# ORDER BY s.student_name, c.course_name;
 student_name |   course_name   | enrollment_date | grade
--------------+-----------------+-----------------+-------
 Aibek        | Mathematics     | 2024-01-20      | A
 Aibek        | Physics         | 2024-02-10      | B
 Ainura       | CS Fundamentals | 2024-02-12      | A
(3 rows)


database_labs=# SELECT c.name
database_labs-# FROM customers c
database_labs-# LEFT JOIN orders o ON c.customer_id = o.customer_id
database_labs-# WHERE o.customer_id IS NULL;
 name
-------
 Carol
(1 row)


database_labs=# CREATE INDEX idx_orders_customer_id ON orders(customer_id);
CREATE INDEX
database_labs=#
database_labs=# CREATE INDEX idx_order_items_order_id ON order_items(order_id);
CREATE INDEX
database_labs=# CREATE INDEX idx_order_items_product_id ON order_items(product_id);
CREATE INDEX
database_labs=#